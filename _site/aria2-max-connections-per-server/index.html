<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" /><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="Full-Stack Developer, Programming, Machine Learning, IoT"><meta name="theme-color" content="#000000"><title>Recompile aria2 to increment max connections per server | Jirawat Boonkumnerd</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Recompile aria2 to increment max connections per server" /><meta name="author" content="ntsd" /><meta property="og:locale" content="en_US" /><meta name="description" content="There’s maximum 16 connection hard code in aria2 so when I want to split more connection I need to edit a line of code and recompile it" /><meta property="og:description" content="There’s maximum 16 connection hard code in aria2 so when I want to split more connection I need to edit a line of code and recompile it" /><link rel="canonical" href="https://ntsd.me/aria2-max-connections-per-server/" /><meta property="og:url" content="https://ntsd.me/aria2-max-connections-per-server/" /><meta property="og:site_name" content="Jirawat Boonkumnerd" /><meta property="og:image" content="https://ntsd.me/pwa/icons/512.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-02-09T19:30:54+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:image" content="https://ntsd.me/pwa/icons/512.png" /><meta property="twitter:title" content="Recompile aria2 to increment max connections per server" /><meta name="twitter:site" content="@ntsd_me" /><meta name="twitter:creator" content="@ntsd" /><meta property="fb:admins" content="jo.ntsd" /><meta property="article:publisher" content="ntsd.me" /><meta property="fb:app_id" content="523337598616322" /> <script type="application/ld+json"> {"dateModified":"2020-02-09T19:30:54+07:00","image":"https://ntsd.me/pwa/icons/512.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://ntsd.me/aria2-max-connections-per-server/"},"url":"https://ntsd.me/aria2-max-connections-per-server/","author":{"@type":"Person","name":"ntsd"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ntsd.me/pwa/icons/512.png"},"name":"ntsd"},"description":"There’s maximum 16 connection hard code in aria2 so when I want to split more connection I need to edit a line of code and recompile it","headline":"Recompile aria2 to increment max connections per server","@type":"BlogPosting","datePublished":"2020-02-09T19:30:54+07:00","@context":"https://schema.org"}</script><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="manifest" href="/pwa/manifest.json" defer><link rel="stylesheet" href="/css/ntsd-blog.min.css" defer><link rel="shortcut icon" href="/favicon.ico" defer><link rel="apple-touch-icon" href="/favicon.ico" defer> <script></script><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class="container-fluid"><div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Jirawat Boonkumnerd</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li> <a href="/">Home</a><li> <a href="/categories/">Categories</a><li> <a href="/portfolio/">Portfolio</a><li> <a href="/tags/">Tags</a></ul></div></div></div></nav><script> var $body = document.body; var $toggle = document.querySelector('.navbar-toggle'); var $navbar = document.querySelector('#huxblog_navbar'); var $collapse = document.querySelector('.navbar-collapse'); var __HuxNav__ = { close: function(){ $navbar.className = " "; setTimeout(function() { if($navbar.className.indexOf('in') < 0) { $collapse.style.height = "0px"; } }, 400); }, open: function() { $collapse.style.height = "auto"; $navbar.className += " in"; } }; $toggle.addEventListener('click', function(e) { if ($navbar.className.indexOf('in') > 0) { __HuxNav__.close(); } else{ __HuxNav__.open(); } }); document.addEventListener('click', function(e){ if(e.target == $toggle) return; if(e.target.className == 'icon-bar') return; __HuxNav__.close(); }); </script><style type="text/css"> header.intro-header { position: relative; background-image: url('/../img/in-post/2020-2-9-aria2-max-connections-per-server/header.jpg'); }</style><header class="intro-header" ><div class="intro-header-inner"><div class="header-mask"></div><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"> <span class="categories"> <a class="category" href="/categories/#Network" title="Network">Network</a> </span> <span class="tags"> <a class="tag" href="/tags/#Programming" title="Programming">Programming</a> <a class="tag" href="/tags/#C++" title="C++">C++</a> <a class="tag" href="/tags/#aria2" title="aria2">aria2</a> <a class="tag" href="/tags/#Network" title="Network">Network</a> </span><h1>Recompile aria2 to increment max connections per server</h1><h2 class="subheading">Edit a line of code and re-complie aria2 to unlock aria 2 connections limit</h2><span class="meta">Posted by ntsd on February 9, 2020</span></div></div></div></div></div></header><article><div class="container"><div class="row"><div class=" col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container"><p>There’s maximum 16 connection hard code in aria2 so when I want to split more connection I need to edit a line of code and recompile it</p><h2 id="edit-max-connections-per-server">Edit max connections per server</h2><p>Edit number arguments in NumberOptionHandler for MAX_CONNECTION_PER_SERVER in file “OptionHandlerFactory.cc”</p><p>from 16 to 64 the number is as you want.</p><div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">OptionHandler</span><span class="o">*</span> <span class="nf">op</span><span class="p">(</span><span class="k">new</span> <span class="n">NumberOptionHandler</span><span class="p">(</span><span class="n">PREF_MAX_CONNECTION_PER_SERVER</span><span class="p">,</span>
                                              <span class="n">TEXT_MAX_CONNECTION_PER_SERVER</span><span class="p">,</span>
                                              <span class="s">"1"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="sc">'x'</span><span class="p">));</span>
</code></pre></div></div><h2 id="build-the-aria-2">Build the aria 2</h2><p>Install following packages.</p><ul><li>libxml2-dev<li>libcppunit-dev<li>autoconf (gettext)<li>automake<li>autotools-dev<li>autopoint<li>libtool</ul><p>You can install by run this command.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>gettext automake autoconf libtool libxml2 cppunit
</code></pre></div></div><p>If you install LibXML with brew you also need to link it to <code class="highlighter-rouge">/usr/local/include/</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo ln</span> <span class="nt">-s</span> /usr/local/opt/libxml2/include/libxml2/libxml /usr/local/include/libxml
</code></pre></div></div><p>Add Gettext and libxml2 to your path for me it’s <code class="highlighter-rouge">~/.zshrc</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># gettext</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">PATH</span><span class="k">}</span>:/usr/local/opt/gettext/bin

<span class="c"># libxml2</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/usr/local/opt/libxml2/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-L/usr/local/opt/libxml2/lib"</span>
<span class="nb">export </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">"-I/usr/local/opt/libxml2/include"</span>
</code></pre></div></div><p>Generate configs.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>autoreconf <span class="nt">-i</span>
</code></pre></div></div><p>Run config you that you just create.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure
</code></pre></div></div><p>I’ll just using the default configuration.</p><p>If you want more details of it you can just copy steps from homebrew script here <a href="https://github.com/Homebrew/homebrew-core/blob/master/Formula/aria2.rb">https://github.com/Homebrew/homebrew-core/blob/master/Formula/aria2.rb</a>.</p><p>Generate make file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make
</code></pre></div></div><p>Test all code (you can skip this step).</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make check
</code></pre></div></div><p>Run make install to generate the binary file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nb">install</span>
</code></pre></div></div><p>Then you’ll get new aria2c binary file complied in <code class="highlighter-rouge">/usr/local/bin/</code> directory.</p><p>You can check by the command.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-latr</span> /usr/local/bin/
</code></pre></div></div><h2 id="test-the-compiled-aria2-binary-file">Test the compiled aria2 binary file</h2><p>Make sure <code class="highlighter-rouge">/usr/local/bin/</code> is in your path.</p><p>Now you can test the aria2c binary file that you just compile.</p><p><code class="highlighter-rouge">aria2c -k 1M -s 64 -x 64 http://ipv4.download.thinkbroadband.com/1GB.zip</code></p><p>Basic Options</p><p>-k, –min-split-size=&lt;SIZE&gt;</p><ul><li>minimum split size</ul><p>-s, –split=&lt;N&gt;</p><ul><li>split file to N part</ul><p>-x, –max-connection-per-server=&lt;NUM&gt;</p><ul><li>maximum number connections to one server.</ul><p>You’ll see the number of connections is 64.</p><p><img src="/img/in-post/2020-2-9-aria2-max-connections-per-server/aria.png" alt="the number of connections is 64" /></p><p>Done, Now you can use the binary file and unlock aria 2 connections limit.</p><h2 id="references">references</h2><ul><li><a href="https://github.com/aria2/aria2">https://github.com/aria2/aria2</a><li><a href="https://github.com/aria2/aria2/issues/580">https://github.com/aria2/aria2/issues/580</a><li><a href="https://github.com/aria2/aria2/issues/810">https://github.com/aria2/aria2/issues/810</a><li><a href="https://aria2.github.io/manual/en/html/README.html#how-to-build">https://aria2.github.io/manual/en/html/README.html#how-to-build</a></ul><hr style="visibility: hidden;"><ul class="pager"><li class="previous"> <a href="/python-codegolf/" data-toggle="tooltip" data-placement="top" title="Python Code Golf Cheat Sheet"> Previous<br> <span>Python Code Golf Cheat Sheet</span> </a><li class="next"> <a href="/install-openwrt-on-banana-pi-r64/" data-toggle="tooltip" data-placement="top" title="Build and Install OpenWRT on Banana Pi R64"> Next<br> <span>Build and Install OpenWRT on Banana Pi R64</span> </a></ul></div><div class=" col-lg-2 col-lg-offset-0 visible-lg-block sidebar-container catalog-container"><div class="side-catalog"><h5> <a class="catalog-toggle" href="#">Contents</a></h5><ul class="catalog-body"></ul></div></div><div class=" col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href="/tags/">FEATURED TAGS</a></h5><div class="tags"> <a href="/tags/#General" title="General" rel="1"> General </a> <a href="/tags/#Artificial Intelligence" title="Artificial Intelligence" rel="1"> Artificial Intelligence </a> <a href="/tags/#Programming" title="Programming" rel="6"> Programming </a> <a href="/tags/#Python" title="Python" rel="2"> Python </a> <a href="/tags/#Code golf" title="Code golf" rel="1"> Code golf </a> <a href="/tags/#C++" title="C++" rel="1"> C++ </a> <a href="/tags/#aria2" title="aria2" rel="1"> aria2 </a> <a href="/tags/#Network" title="Network" rel="2"> Network </a> <a href="/tags/#OpenWRT" title="OpenWRT" rel="1"> OpenWRT </a> <a href="/tags/#Router" title="Router" rel="1"> Router </a> <a href="/tags/#Embedded" title="Embedded" rel="1"> Embedded </a> <a href="/tags/#Gatsby" title="Gatsby" rel="1"> Gatsby </a> <a href="/tags/#React" title="React" rel="1"> React </a> <a href="/tags/#GraphQL" title="GraphQL" rel="1"> GraphQL </a> <a href="/tags/#Progressive Web App" title="Progressive Web App" rel="1"> Progressive Web App </a> <a href="/tags/#TypeScript" title="TypeScript" rel="2"> TypeScript </a> <a href="/tags/#Facebook Developer" title="Facebook Developer" rel="1"> Facebook Developer </a> <a href="/tags/#ESLint" title="ESLint" rel="1"> ESLint </a> <a href="/tags/#Hosting" title="Hosting" rel="1"> Hosting </a> <a href="/tags/#Website" title="Website" rel="1"> Website </a> <a href="/tags/#Web Performance" title="Web Performance" rel="1"> Web Performance </a></div></section></div></div></div></article><script> function async(u, c) { var d = document, t = 'script', o = d.createElement(t), s = d.getElementsByTagName(t)[0]; o.src = u; if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); } s.parentNode.insertBefore(o, s); } </script> <script> async("https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){ anchors.options = { visible: 'always', placement: 'right', icon: '#' }; anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5'); }) </script><style> /* place left on bigger screen */ @media all and (min-width: 800px) { .anchorjs-link{ position: absolute; left: -0.75em; font-size: 1.1em; margin-top : -0.1em; } }</style><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li> <a target="_blank" href="https://www.facebook.com/jo.ntsd" aria-label="Facebook" rel="noopener noreferrer"> <svg class="svg-icon logo-facebook"></svg> </a><li> <a target="_blank" href="https://github.com/ntsd" aria-label="Github" rel="noopener noreferrer"> <svg class="svg-icon logo-github"></svg> </a><li> <a target="_blank" href="https://www.linkedin.com/in/ntsd" aria-label="Linkedin" rel="noopener noreferrer"> <svg class="svg-icon logo-linkedin"></svg> </a></ul><div class="copyright"><div> Copyright &copy; Jirawat Boonkumnerd 2020</div><div> Made with ❤️ by <a href="https://ntsd.me">ntsd</a></div></div></div></div></div></footer><script src="/js/snackbar.min.js" defer></script> <script src="/js/sw-registration.min.js" defer></script> <script> function async(u, c) { var d = document, t = 'script', o = d.createElement(t), s = d.getElementsByTagName(t)[0]; o.src = u; if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); } s.parentNode.insertBefore(o, s); } function asyncStyle(u) { var d = document, t = 'link', o = d.createElement(t), s = d.getElementsByTagName(t)[0]; o.href = u; o.rel="stylesheet"; s.parentNode.insertBefore(o, s); } </script> <script src="/js/jquery.min.js"></script> <script src="/js/ntsd-blog.min.js" defer></script> <script> async("/js/prism.min.js"); asyncStyle("/css/prism.min.css"); </script> <script type="text/javascript"> function generateCatalog (selector) { /* interop with multilangual */ if ('' == 'true') { _containerSelector = 'div.post-container.active'; } else { _containerSelector = 'div.post-container'; } /* init */ var P = $(_containerSelector),a,n,t,l,i,c; /* side catalog level */ a = P.find('h1,h2'); /* clean */ $(selector).html(''); /* appending */ a.each(function () { n = $(this).prop('tagName').toLowerCase(); i = "#"+$(this).prop('id'); t = $(this).text(); c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>'); l = $('<li class="'+n+'_nav">').append(c); $(selector).append(l); }); return true; } generateCatalog(".catalog-body"); /* toggle side catalog */ $(".catalog-toggle").click((function(e) { e.preventDefault(); $('.side-catalog').toggleClass("fold"); })); /* Doc: https://github.com/davist11/jQuery-One-Page-Nav Fork by Hux to support padding */ async("/js/jquery.nav.min.js", function () { $('.catalog-body').onePageNav({ currentClass: "active", changeHash: !1, easing: "swing", filter: "", scrollSpeed: 700, scrollOffset: 0, scrollThreshold: .2, begin: null, end: null, scrollChange: null, padding: 80 }); }); </script>
