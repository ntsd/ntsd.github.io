<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" /><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="Full-Stack Developer, Programming, Machine Learning, IoT"><meta name="theme-color" content="#000000"><title>Build and Install OpenWRT on Banana Pi R64 | Jirawat Boonkumnerd</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Build and Install OpenWRT on Banana Pi R64" /><meta name="author" content="ntsd" /><meta property="og:locale" content="en_US" /><meta name="description" content="This tutorial is a getting start to build OpenWRT image and install on Banana Pi R64, This guide also works with the Banana Pi R2 but it will be a difference in some steps." /><meta property="og:description" content="This tutorial is a getting start to build OpenWRT image and install on Banana Pi R64, This guide also works with the Banana Pi R2 but it will be a difference in some steps." /><link rel="canonical" href="https://ntsd.me/install-openwrt-on-banana-pi-r64/" /><meta property="og:url" content="https://ntsd.me/install-openwrt-on-banana-pi-r64/" /><meta property="og:site_name" content="Jirawat Boonkumnerd" /><meta property="og:image" content="https://ntsd.me/pwa/icons/512.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-03-03T19:30:54+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:image" content="https://ntsd.me/pwa/icons/512.png" /><meta property="twitter:title" content="Build and Install OpenWRT on Banana Pi R64" /><meta name="twitter:site" content="@ntsd_me" /><meta name="twitter:creator" content="@ntsd" /><meta property="fb:admins" content="jo.ntsd" /><meta property="article:publisher" content="ntsd.me" /><meta property="fb:app_id" content="523337598616322" /> <script type="application/ld+json"> {"dateModified":"2020-03-03T19:30:54+07:00","image":"https://ntsd.me/pwa/icons/512.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://ntsd.me/install-openwrt-on-banana-pi-r64/"},"url":"https://ntsd.me/install-openwrt-on-banana-pi-r64/","author":{"@type":"Person","name":"ntsd"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ntsd.me/pwa/icons/512.png"},"name":"ntsd"},"description":"This tutorial is a getting start to build OpenWRT image and install on Banana Pi R64, This guide also works with the Banana Pi R2 but it will be a difference in some steps.","headline":"Build and Install OpenWRT on Banana Pi R64","@type":"BlogPosting","datePublished":"2020-03-03T19:30:54+07:00","@context":"https://schema.org"}</script><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="manifest" href="/pwa/manifest.json" defer><link rel="stylesheet" href="/css/bootstrap.min.css" defer><link rel="stylesheet" href="/css/ntsd-blog.min.css" defer><link rel="shortcut icon" href="/favicon.ico" defer><link rel="apple-touch-icon" href="/favicon.ico" defer> <script></script><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class="container-fluid"><div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Jirawat Boonkumnerd</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li> <a href="/">Home</a><li> <a href="/categories/">Categories</a><li> <a href="/portfolio/">Portfolio</a><li> <a href="/tags/">Tags</a></ul></div></div></div></nav><script> var $body = document.body; var $toggle = document.querySelector('.navbar-toggle'); var $navbar = document.querySelector('#huxblog_navbar'); var $collapse = document.querySelector('.navbar-collapse'); var __HuxNav__ = { close: function(){ $navbar.className = " "; setTimeout(function() { if($navbar.className.indexOf('in') < 0) { $collapse.style.height = "0px"; } }, 400); }, open: function() { $collapse.style.height = "auto"; $navbar.className += " in"; } }; $toggle.addEventListener('click', function(e) { if ($navbar.className.indexOf('in') > 0) { __HuxNav__.close(); } else{ __HuxNav__.open(); } }); document.addEventListener('click', function(e){ if(e.target == $toggle) return; if(e.target.className == 'icon-bar') return; __HuxNav__.close(); }); </script><style type="text/css"> header.intro-header { position: relative; background-image: url('/../img/in-post/2020-1-3-install-openwrt-on-banana-pi-r64/plash-speed-2.jpg'); }</style><header class="intro-header" ><div class="intro-header-inner"><div class="header-mask"></div><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"> <span class="categories"> <a class="category" href="/categories/#Network" title="Network">Network</a> </span> <span class="tags"> <a class="tag" href="/tags/#OpenWRT" title="OpenWRT">OpenWRT</a> <a class="tag" href="/tags/#Router" title="Router">Router</a> <a class="tag" href="/tags/#Network" title="Network">Network</a> <a class="tag" href="/tags/#Embedded" title="Embedded">Embedded</a> </span><h1>Build and Install OpenWRT on Banana Pi R64</h1><h2 class="subheading">Getting start to build and install OpenWRT on Banana Pi R64 by using macOS</h2><span class="meta">Posted by ntsd on March 3, 2020</span></div></div></div></div></div></header><article><div class="container"><div class="row"><div class=" col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container"><p>This tutorial is a getting start to build OpenWRT image and install on Banana Pi R64, This guide also works with the Banana Pi R2 but it will be a difference in some steps.</p><h2 id="what-is-banana-pi-r64">What is Banana Pi R64</h2><p>The Banana Pi R64 is a router-based development board running with ARM Chipset MediaTek MT7622. So you can install operating systems which support to this ARM CPU including OpenWrt, Ubuntu, or many Linux distributions. It has many interfaces support such as on board Wifi/Bluetooth, 1GB Ethernet, USB 3.0, 40 GPIO, etc. Banana Pi R64 can add a Mini-PCI Express Modules and PoE module. And It also has a performance, resource, and interfaces good enough to be a high-end router.</p><h3 id="banana-pi-r64-specifications">Banana Pi R64 Specifications</h3><ul><li>MediaTek MT7622,1.35GHZ 64 bit dual-core ARM Cortex-A53<li>1G DDR3 SDRAM<li>Mini PCIE interface support 4G module<li>Built-in 4x4n 802.11n/Bluetooth 5.0 system-on-chip<li>MTK7615 4x4ac wifi on board<li>Support 1 SATA interface<li>MicroSD slot supports up to 256GB expansion<li>8G eMMC flash (option 16/32/64G)<li>5 port 10/100/1000 Mb Ethernet port<li>1 Port USB 3.0<li>Slow I/O:ADC, Audio Amplifier, GPIO, I2C, I2S, IR, PMIC I/F, PWM, RTC, SPI, UART<li>POE function support</ul><h2 id="requirements">Requirements</h2><ul><li>macOS (I used 10.15.3) *for Ubuntu, will easier to build the image<li>Banana Pi R64<li>MicroSD Card<li>MicroSD Card Reader<li>USB to UART</ul><h2 id="preparation">Preparation</h2><h3 id="install-usb-to-uart-driver">Install USB to UART Driver</h3><p>Just follow this link if you’re using FTDI</p><p><a href="https://learn.sparkfun.com/tutorials/how-to-install-ftdi-drivers/all">https://learn.sparkfun.com/tutorials/how-to-install-ftdi-drivers/all</a></p><p>here is for CP2102</p><p><a href="https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers">https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers</a></p><h3 id="terminal-software-for-serial">Terminal software for serial</h3><p>you can use whatever serial console Putty, screen, minicom</p><p>for this tutorial I use <code class="highlighter-rouge">screen</code></p><h3 id="download-images">Download images</h3><h4 id="sd-card-image">SD card image</h4><p><a href="https://drive.google.com/open?id=1Ap7lt-pjpG-pAOAEqpH13-SMOSkRkZI0">https://drive.google.com/open?id=1Ap7lt-pjpG-pAOAEqpH13-SMOSkRkZI0</a></p><h4 id="emmc-all-in-one-single-image">eMMC all-in-one single image</h4><p>includes GPT, ATF, u-boot, and Linux kernel image</p><p><a href="https://drive.google.com/open?id=1w8kO3klbPfdHK6lTI8Ub8sR_7ViISORM">https://drive.google.com/open?id=1w8kO3klbPfdHK6lTI8Ub8sR_7ViISORM</a></p><h4 id="emmc-preloader">eMMC preloader</h4><p><a href="https://drive.google.com/open?id=1Fy__GpNSWRcITEmzH4Z_jxnjrCS3BpQJ">https://drive.google.com/open?id=1Fy__GpNSWRcITEmzH4Z_jxnjrCS3BpQJ</a></p><h2 id="setup-boot-from-emmc">Setup boot from eMMC</h2><p>this step will allow you to build image to eMMC storage on the board instead sd card</p><h3 id="write-sd-card-image-into-sd-card">Write SD card image into SD card</h3><p>You need to boot via sd card first to write preloader and eMMC all-in-one single image</p><p><code class="highlighter-rouge">dd if=sdcardimage.img of=/dev/sdX</code></p><p>replace <code class="highlighter-rouge">sdX</code> with your drive</p><h3 id="run-tftp-server">Run TFTP server</h3><p>You can your system TFTP Server but for easy on and off the service so I use 3rd party TFTP Server.</p><h4 id="tftp-server">TFTP server</h4><p>you can download here <a href="http://ww2.unime.it/flr/tftpserver">http://ww2.unime.it/flr/tftpserver</a></p><h4 id="macos-build-in-tftp-optional">MacOS build-in tftp (optional)</h4><p>If you don’t like to install 3rd party software you can use system TFTP Service</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>launchctl load <span class="nt">-F</span> /System/Library/LaunchDaemons/tftp.plist

<span class="nb">sudo </span>launchctl start com.apple.tftpd

<span class="nb">cd</span> /var/tftpboot <span class="nb">touch</span> <span class="c"># make initial tftp directory</span>
</code></pre></div></div><h4 id="copy-file-to-tftp-folder">Copy file to tftp folder</h4><p>change mode your directory to allow other users to read and write files</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>777 /private/tftpboot
</code></pre></div></div><p>copy the binary file into TFTP root directory</p><p><img src="/img/in-post/2020-1-3-install-openwrt-on-banana-pi-r64/1.png" alt="copy the binary file into TFTP root directory" /></p><h3 id="connect-to-board-by-uart">Connect to board by UART</h3><p>use serial 115200 baud for Bananapi r64</p><p><code class="highlighter-rouge">sudo screen /dev/cu.usbserial-A50285BI 115200</code></p><p>replace <code class="highlighter-rouge">cu.usbserial-A50285BI</code> with your serial driver</p><h3 id="set-u-boot-env">Set u-boot env</h3><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setenv ipaddr 192.168.1.126 <span class="c"># your bpi ip address</span>
setenv serverip 192.168.1.1 <span class="c"># your tfto server</span>
setenv netmask 255.255.255.0
saveenv
</code></pre></div></div><p>check u-boot env</p><p><code class="highlighter-rouge">printenv</code></p><p>return to u-boot menu</p><p><code class="highlighter-rouge">bootmenu</code></p><h3 id="write-emmc-image-to-flash-via-tftp">Write eMMC image to flash via TFTP</h3><p>Put Ethernet to WLAN port for connect to the router</p><p>make sure your TFTP server in the same network with your bpi board</p><h4 id="install-emmc-flash-image-to-flash">Install eMMC flash image to flash</h4><p>in u-boot menu choose “b. System Load flash image then write to Flash via TFTP”</p><p><img src="/img/in-post/2020-1-3-install-openwrt-on-banana-pi-r64/2.png" alt="b. System Load flash image then write to Flash via TFTP" /></p><p>Set TFTP server IP and flash image file name</p><p><img src="/img/in-post/2020-1-3-install-openwrt-on-banana-pi-r64/3.png" alt="Set TFTP server ip and flash image file name" /></p><h4 id="install-preloader-to-flash">Install preloader to flash</h4><p>back to U-Boot menu choose “7. System Load Preloader then write to Flash via TFTP”</p><p><img src="/img/in-post/2020-1-3-install-openwrt-on-banana-pi-r64/4.png" alt="7. System Load Preloader then write to Flash via TFTP" /></p><p>Set TFTP server IP address and preloader file name</p><p><img src="/img/in-post/2020-1-3-install-openwrt-on-banana-pi-r64/5.png" alt="Set TFTP server ip and preloader file name" /></p><p>Remove sd card and power-off The Banana pi, Remove SD card, and Power on.</p><p>Now you’ll get U-BOOT installed on eMMC storage</p><p><img src="/img/in-post/2020-1-3-install-openwrt-on-banana-pi-r64/6.png" alt="U-BOOT install on eMMC on board storage" /></p><h2 id="build-your-openwrt-image">Build your OpenWRT image</h2><h3 id="preparation-to-build-openwrt-image">Preparation to build OpenWRT image</h3><p>follow the link for more information <a href="https://openwrt.org/docs/guide-developer/buildroot.exigence.macosx">https://openwrt.org/docs/guide-developer/buildroot.exigence.macosx</a></p><h4 id="setup-macosx-as-an-openwrt-build-environment">Setup MacOSX as an OpenWrt build environment</h4><p>Install these package by Homebrew</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>coreutils diffutils findutils gawk gnu-getopt gnu-tar <span class="nb">grep </span>wget quilt xz

<span class="c"># Link gnu-getopt to local gnugetopt</span>
<span class="nb">ln</span> <span class="nt">-s</span> <span class="sb">`</span>brew <span class="nt">--prefix</span> gnu-getopt<span class="sb">`</span>/bin/getopt <span class="sb">`</span>brew <span class="nt">--prefix</span><span class="sb">`</span>/bin/gnugetopt
</code></pre></div></div><p>add gnu-getopt to your path</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/usr/local/opt/gnu-getopt/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div></div><h4 id="create-case-insensitive-filesystem">Create case-insensitive filesystem</h4><p>OS X by default comes with a case-insensitive filesystem. OpenWrt won’t build on that. As a workaround, create a (Sparse) case-sensitive disk-image that you then mount in the finder and use as build directory</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hdiutil create <span class="nt">-size</span> 20g <span class="nt">-type</span> SPARSE <span class="nt">-fs</span> <span class="s2">"Case-sensitive HFS+"</span> <span class="nt">-volname</span> OpenWrt OpenWrt.sparseimage

<span class="c"># mount the image</span>
hdiutil attach OpenWrt.sparseimage
</code></pre></div></div><p>change directory to /Volumes/OpenWrt</p><p><code class="highlighter-rouge">cd /Volumes/OpenWrt</code></p><h3 id="build-openwrt-image-for-mt7622">Build OpenWRT Image for MT7622</h3><h4 id="clone-openwrt-project">Clone OpenWRT project</h4><p><code class="highlighter-rouge">git clone https://github.com/openwrt/openwrt.git</code></p><h4 id="set-parametres">Set parametres</h4><p>Target System: MediaTek Ralink ARM</p><p>Subtarget: MT7622</p><p>Target Profile: Banana Pi R64</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>openwrt

./scripts/feeds update <span class="nt">-a</span>
./scripts/feeds <span class="nb">install</span> <span class="nt">-a</span>

make menuconfig
</code></pre></div></div><p>Set config and include built-in dependency that you want (Luci is not included by default)</p><p>then save to <code class="highlighter-rouge">.config</code></p><h4 id="build-openwrt-image">Build OpenWRT image</h4><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># for 10.15 need set deploy target it to 10.14</span>
<span class="nv">MACOSX_DEPLOYMENT_TARGET</span><span class="o">=</span>10.14

<span class="c"># Start make</span>
<span class="c"># vadd v1 mean verbose Level 1 (warnings/errors), level 99 (stdout+stderr)</span>
<span class="c"># add -j4 mean use quard core</span>
make <span class="nt">-j4</span> <span class="nv">V</span><span class="o">=</span>1
</code></pre></div></div><p>Kernel image file will be at ./bin/targets/mediatek/mt7622/openwrt-mediatek-mt7622-bpi_bananapi-r64-initramfs-kernel.bin</p><h4 id="install-openwrt-image-to-bananapi-via-tftp">Install OpenWRT Image to Bananapi via TFTP</h4><p>Copy the kernel image to TFTP folder</p><p><code class="highlighter-rouge">cp ./bin/targets/mediatek/mt7622/openwrt-mediatek-mt7622-bpi_bananapi-r64-initramfs-kernel.bin /private/tftpboot/</code></p><p>Enter to the U-Boot menu</p><p>Install kernel image from TFTP</p><p><img src="/img/in-post/2020-1-3-install-openwrt-on-banana-pi-r64/8.png" alt="Install kernel image from TFTP" /></p><p>Finally, I got The OpenWRT image installed</p><p><img src="/img/in-post/2020-1-3-install-openwrt-on-banana-pi-r64/7.png" alt="OpenWRT installed" /></p><h2 id="references">References</h2><ul><li><a href="http://wiki.banana-pi.org/Banana_Pi_BPI-R64">http://wiki.banana-pi.org/Banana_Pi_BPI-R64</a><li><a href="http://forum.banana-pi.org/t/bpi-r64-loading-openwrt-built-files-into-the-board/9960">http://forum.banana-pi.org/t/bpi-r64-loading-openwrt-built-files-into-the-board/9960</a><li><a href="http://forum.banana-pi.org/t/bpi-r64-quick-start-boot-from-emmc/9809">http://forum.banana-pi.org/t/bpi-r64-quick-start-boot-from-emmc/9809</a><li><a href="https://openwrt.org/docs/guide-developer">https://openwrt.org/docs/guide-developer</a></ul><hr style="visibility: hidden;"><ul class="pager"><li class="previous"> <a href="/aria2-max-connections-per-server/" data-toggle="tooltip" data-placement="top" title="Recompile aria2 to increment max connections per server"> Previous<br> <span>Recompile aria2 to increment max connections per server</span> </a><li class="next"> <a href="/build-a-static-website-with-gatsby/" data-toggle="tooltip" data-placement="top" title="Build a static website with Gatsby and TypeScript"> Next<br> <span>Build a static website with Gatsby and TypeScript</span> </a></ul></div><div class=" col-lg-2 col-lg-offset-0 visible-lg-block sidebar-container catalog-container"><div class="side-catalog"><h5> <a class="catalog-toggle" href="#">Contents</a></h5><ul class="catalog-body"></ul></div></div><div class=" col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href="/tags/">FEATURED TAGS</a></h5><div class="tags"> <a href="/tags/#General" title="General" rel="1"> General </a> <a href="/tags/#Artificial Intelligence" title="Artificial Intelligence" rel="1"> Artificial Intelligence </a> <a href="/tags/#Programming" title="Programming" rel="6"> Programming </a> <a href="/tags/#Python" title="Python" rel="2"> Python </a> <a href="/tags/#Code golf" title="Code golf" rel="1"> Code golf </a> <a href="/tags/#C++" title="C++" rel="1"> C++ </a> <a href="/tags/#aria2" title="aria2" rel="1"> aria2 </a> <a href="/tags/#Network" title="Network" rel="2"> Network </a> <a href="/tags/#OpenWRT" title="OpenWRT" rel="1"> OpenWRT </a> <a href="/tags/#Router" title="Router" rel="1"> Router </a> <a href="/tags/#Embedded" title="Embedded" rel="1"> Embedded </a> <a href="/tags/#Gatsby" title="Gatsby" rel="1"> Gatsby </a> <a href="/tags/#React" title="React" rel="1"> React </a> <a href="/tags/#GraphQL" title="GraphQL" rel="1"> GraphQL </a> <a href="/tags/#Progressive Web App" title="Progressive Web App" rel="1"> Progressive Web App </a> <a href="/tags/#TypeScript" title="TypeScript" rel="2"> TypeScript </a> <a href="/tags/#Facebook Developer" title="Facebook Developer" rel="1"> Facebook Developer </a> <a href="/tags/#ESLint" title="ESLint" rel="1"> ESLint </a></div></section></div></div></div></article><script> function async(u, c) { var d = document, t = 'script', o = d.createElement(t), s = d.getElementsByTagName(t)[0]; o.src = u; if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); } s.parentNode.insertBefore(o, s); } </script> <script> async("https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){ anchors.options = { visible: 'always', placement: 'right', icon: '#' }; anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5'); }) </script><style> /* place left on bigger screen */ @media all and (min-width: 800px) { .anchorjs-link{ position: absolute; left: -0.75em; font-size: 1.1em; margin-top : -0.1em; } }</style><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li> <a target="_blank" href="https://www.facebook.com/jo.ntsd" aria-label="Facebook" rel="noopener noreferrer"> <svg class="svg-icon logo-facebook"></svg> </a><li> <a target="_blank" href="https://github.com/ntsd" aria-label="Github" rel="noopener noreferrer"> <svg class="svg-icon logo-github"></svg> </a><li> <a target="_blank" href="https://www.linkedin.com/in/ntsd" aria-label="Linkedin" rel="noopener noreferrer"> <svg class="svg-icon logo-linkedin"></svg> </a></ul><div class="copyright"><div> Copyright &copy; Jirawat Boonkumnerd 2020</div><div> Made with ❤️ by <a href="https://ntsd.me">ntsd</a></div></div></div></div></div></footer><script src="/js/snackbar.min.js" defer></script> <script src="/js/sw-registration.min.js" defer></script> <script> function async(u, c) { var d = document, t = 'script', o = d.createElement(t), s = d.getElementsByTagName(t)[0]; o.src = u; if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); } s.parentNode.insertBefore(o, s); } function asyncStyle(u) { var d = document, t = 'link', o = d.createElement(t), s = d.getElementsByTagName(t)[0]; o.href = u; o.rel="stylesheet"; s.parentNode.insertBefore(o, s); } </script> <script src="/js/jquery.min.js"></script> <script src="/js/ntsd-blog.min.js" defer></script> <script> async("/js/prism.min.js"); asyncStyle("/css/prism.min.css"); </script> <script> async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function() { var $nav = document.querySelector("nav"); if ($nav) FastClick.attach($nav); }); </script> <script type="text/javascript"> function generateCatalog (selector) { /* interop with multilangual */ if ('' == 'true') { _containerSelector = 'div.post-container.active'; } else { _containerSelector = 'div.post-container'; } /* init */ var P = $(_containerSelector),a,n,t,l,i,c; /* side catalog level */ a = P.find('h1,h2'); /* clean */ $(selector).html(''); /* appending */ a.each(function () { n = $(this).prop('tagName').toLowerCase(); i = "#"+$(this).prop('id'); t = $(this).text(); c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>'); l = $('<li class="'+n+'_nav">').append(c); $(selector).append(l); }); return true; } generateCatalog(".catalog-body"); /* toggle side catalog */ $(".catalog-toggle").click((function(e) { e.preventDefault(); $('.side-catalog').toggleClass("fold"); })); /* Doc: https://github.com/davist11/jQuery-One-Page-Nav Fork by Hux to support padding */ async("/js/jquery.nav.min.js", function () { $('.catalog-body').onePageNav({ currentClass: "active", changeHash: !1, easing: "swing", filter: "", scrollSpeed: 700, scrollOffset: 0, scrollThreshold: .2, begin: null, end: null, scrollChange: null, padding: 80 }); }); </script>
